"use strict";!function(t,e){"function"==typeof define&&define.amd?define(["jquery","moment"],e):"object"==typeof exports?module.exports=e(require("jquery"),require("moment")):t.Calendar=e(jQuery,moment)}(this,function(h,c){function t(t){var s=this;this.settings=t,this.calIsOpen=!1,this.presetIsOpen=!1,this.sameDayRange=t.same_day_range||!1,this.element=t.element||h(".daterange"),this.selected=null,this.type=this.element.hasClass("daterange--single")?"single":"double",this.required=0!=t.required,this.format=t.format||{},this.format.input=t.format&&t.format.input||"MMMM D, YYYY",this.format.preset=t.format&&t.format.preset||"ll",this.format.jump_month=t.format&&t.format.jump_month||"MMMM",this.format.jump_year=t.format&&t.format.jump_year||"YYYY",this.placeholder=t.placeholder||this.format.input,this.days_array=t.days_array&&7==t.days_array.length?t.days_array:c.weekdaysMin(),this.orig_start_date=null,this.orig_end_date=null,this.orig_current_date=null,this.earliest_date=t.earliest_date?c(t.earliest_date):c("1900-01-01","YYYY-MM-DD"),this.latest_date=t.latest_date?c(t.latest_date):c("2900-12-31","YYYY-MM-DD"),this.end_date=t.end_date?c(t.end_date):"double"==this.type?c():null,this.start_date=t.start_date?c(t.start_date):"double"==this.type?this.end_date.clone().subtract(1,"month"):null,this.current_date=t.current_date?c(t.current_date):"single"==this.type?c():null,this.presets=0!=t.presets&&"single"!=this.type,this.callback=t.callback||this.calendarSetDates,this.calendarHTML(this.type),h(".dr-presets",this.element).click(function(){s.presetToggle()}),h(".dr-list-item",this.element).click(function(){var t=h(".dr-item-aside",this).data("start"),e=h(".dr-item-aside",this).data("end");s.start_date=s.calendarCheckDate(t),s.end_date=s.calendarCheckDate(e),s.calendarSetDates(),s.presetToggle(),s.calendarSaveDates()}),h(".dr-date",this.element).on({click:function(){s.calendarOpen(this)},keyup:function(t){9!=t.keyCode||s.calIsOpen||s.start_date||s.end_date||s.calendarOpen(this)},keydown:function(t){switch(t.keyCode){case 9:h(s.selected).hasClass("dr-date-start")?(t.preventDefault(),s.calendarCheckDates(),s.calendarSetDates(),h(".dr-date-end",s.element).trigger("click")):(s.calendarCheckDates(),s.calendarSetDates(),s.calendarSaveDates(),s.calendarClose("force"));break;case 13:t.preventDefault(),s.calendarCheckDates(),s.calendarSetDates(),s.calendarSaveDates(),s.calendarClose("force");break;case 27:s.calendarSetDates(),s.calendarClose("force");break;case 38:t.preventDefault();var e="day",a=(t.shiftKey&&(e="week"),t.metaKey&&(e="month"),c(s.current_date).subtract(1,e));h(this).html(a.format(s.format.input)),s.current_date=a;break;case 40:t.preventDefault();e="day",a=(t.shiftKey&&(e="week"),t.metaKey&&(e="month"),c(s.current_date).add(1,e));h(this).html(a.format(s.format.input)),s.current_date=a}}}),h(".dr-month-switcher i",this.element).click(function(){var t=h(".dr-month-switcher span",s.element).data("month"),e=h(".dr-year-switcher span",s.element).data("year"),e=c([e,t,1]),t=e.clone().subtract(1,"month"),e=e.clone().add(1,"month").startOf("day");h(this).hasClass("dr-left")?s.calendarOpen(s.selected,t):h(this).hasClass("dr-right")&&s.calendarOpen(s.selected,e)}),h(".dr-year-switcher i",this.element).click(function(){var t=h(".dr-month-switcher span",s.element).data("month"),e=h(".dr-year-switcher span",s.element).data("year"),e=c([e,t,1]),t=e.clone().subtract(1,"year"),e=e.clone().add(1,"year").startOf("day");h(this).hasClass("dr-left")?s.calendarOpen(s.selected,t):h(this).hasClass("dr-right")&&s.calendarOpen(s.selected,e)}),h(".dr-dates-dash",this.element).click(function(){h(".dr-date-start",s.element).trigger("click")}),this.element.on("click",function(){document.addEventListener("click",function(t){h(t.target).parents(s.element).length||(s.presetIsOpen&&s.presetToggle(),s.calIsOpen&&(h(s.selected).hasClass("dr-date-end")&&s.calendarSaveDates(),s.calendarSetDates(),s.calendarClose("force")))})})}return t.prototype.presetToggle=function(){0==this.presetIsOpen?(this.orig_start_date=this.start_date,this.orig_end_date=this.end_date,this.orig_current_date=this.current_date,this.presetIsOpen=!0):this.presetIsOpen&&(this.presetIsOpen=!1),1==this.calIsOpen&&this.calendarClose(),h(".dr-preset-list",this.element).slideToggle(200),h(".dr-input",this.element).toggleClass("dr-active"),h(".dr-presets",this.element).toggleClass("dr-active"),this.element.toggleClass("dr-active")},t.prototype.presetCreate=function(){var d=this,i=h('<ul class="dr-preset-list" style="display: none;"></ul>'),t="object"==typeof d.settings.presets?d.settings.presets:[{label:"Last 30 days",start:c(d.latest_date).subtract(29,"days"),end:d.latest_date},{label:"Last month",start:c(d.latest_date).subtract(1,"month").startOf("month"),end:c(d.latest_date).subtract(1,"month").endOf("month")},{label:"Last 3 months",start:c(d.latest_date).subtract(3,"month").startOf("month"),end:c(d.latest_date).subtract(1,"month").endOf("month")},{label:"Last 6 months",start:c(d.latest_date).subtract(6,"month").startOf("month"),end:c(d.latest_date).subtract(1,"month").endOf("month")},{label:"Last year",start:c(d.latest_date).subtract(1,"year").startOf("year"),end:c(d.latest_date).subtract(1,"year").endOf("year")},{label:"All time",start:d.earliest_date,end:d.latest_date}];return 6<=c(d.latest_date).diff(c(d.latest_date).startOf("month"),"days")&&"object"!=typeof d.settings.presets&&t.splice(1,0,{label:"This month",start:c(d.latest_date).startOf("month"),end:d.latest_date}),h.each(t,function(t,e){c(e.start).isBefore(d.earliest_date)&&(e.start=d.earliest_date),c(e.start).isAfter(d.latest_date)&&(e.start=d.latest_date),c(e.end).isBefore(d.earliest_date)&&(e.end=d.earliest_date),c(e.end).isAfter(d.latest_date)&&(e.end=d.latest_date);var a=c(e.start).toISOString(),s=c(e.end).toISOString(),r=c(e.start).format(d.format.preset)+" &ndash; "+c(e.end).format(d.format.preset);h(".dr-preset-list",d.element).length?((t=h(".dr-preset-list .dr-list-item:nth-of-type("+(t+1)+") .dr-item-aside",d.element)).data("start",a),t.data("end",s),t.html(r)):i.append('<li class="dr-list-item">'+e.label+'<span class="dr-item-aside" data-start="'+a+'" data-end="'+s+'">'+r+"</span></li>")}),i},t.prototype.calendarSetDates=function(){var t,e;h(".dr-date-start",this.element).html(c(this.start_date).format(this.format.input)),h(".dr-date-end",this.element).html(c(this.end_date).format(this.format.input)),this.start_date||this.end_date||(t=h(".dr-date",this.element).html(),e=c(this.current_date).format(this.format.input),t!=(e=0!==t.length||this.required?e:"")&&h(".dr-date",this.element).html(e))},t.prototype.calendarSaveDates=function(){if("double"===this.type){if(!c(this.orig_end_date).isSame(this.end_date)||!c(this.orig_start_date).isSame(this.start_date))return this.callback()}else if(!this.required||!c(this.orig_current_date).isSame(this.current_date))return this.callback()},t.prototype.calendarCheckDate=function(t){var e;return"today"===t||"now"===t?c().isAfter(this.latest_date)?this.latest_date:c().isBefore(this.earliest_date)?this.earliest_date:c():"earliest"===t?this.earliest_date:"latest"===t?this.latest_date:t&&(/\bago\b/.test(t)||/\bahead\b/.test(t))?this.stringToDate(t):(2==(e=t?t.replace(/(?:\d)((?:st|nd|rd|th)?,?)/,"").split(" "):[]).length&&(e.push(c().format(this.format.jump_year)),t=e.join(" ")),(e=this.parseDate(t)).isValid()?e:c(t))},t.prototype.calendarCheckDates=function(){var t,e=h(".dr-date-start",this.element).html(),a=h(".dr-date-end",this.element).html(),s=this.calendarCheckDate(h(this.selected).html()),e="ytd"===e||"ytd"===a?(t=c().startOf("year"),c().endOf("year")):(t=this.calendarCheckDate(e),this.calendarCheckDate(a));if(s.isBefore(this.earliest_date)&&(s=this.earliest_date),t.isBefore(this.earliest_date)&&(t=this.earliest_date),(e.isBefore(this.earliest_date)||e.isBefore(t))&&(e=t.clone().add(6,"day")),s.isAfter(this.latest_date)&&(s=this.latest_date),e.isAfter(this.latest_date)&&(e=this.latest_date),(t.isAfter(this.latest_date)||t.isAfter(e))&&(t=e.clone().subtract(6,"day")),"double"===this.type){if(t.isSame(e)&&!this.sameDayRange)return this.calendarSetDates();this.start_date=t.isValid()?t:this.start_date,this.end_date=e.isValid()?e:this.end_date}this.current_date=s.isValid()?s:this.current_date},t.prototype.stringToDate=function(t){t=t.split(" ");return"ago"===t[2]?c(this.current_date).subtract(t[0],t[1]):"ahead"===t[2]?c(this.current_date).add(t[0],t[1]):this.current_date},t.prototype.calendarOpen=function(t,e){var i,n=this,a=h(".dr-dates",this.element).innerWidth()-8,s=(this.selected=t||this.selected,1==this.presetIsOpen&&this.presetToggle(),1==this.calIsOpen?this.calendarClose(e?"switcher":void 0):h(this.selected).html().length&&(this.orig_start_date=this.start_date,this.orig_end_date=this.end_date,this.orig_current_date=this.current_date),this.calendarCheckDates(),this.calendarCreate(e),this.calendarSetDates(),c(e||this.current_date).add(1,"month").startOf("month").startOf("day")),r=c(e||this.current_date).subtract(1,"month").endOf("month"),d=c(e||this.current_date).add(1,"year").startOf("month").startOf("day"),l=c(e||this.current_date).subtract(1,"year").endOf("month"),e=c(e||this.current_date);h(".dr-month-switcher span",this.element).data("month",e.month()).html(e.format(this.format.jump_month)),h(".dr-year-switcher span",this.element).data("year",e.year()).html(e.format(this.format.jump_year)),h(".dr-switcher i",this.element).removeClass("dr-disabled"),s.isAfter(this.latest_date)&&h(".dr-month-switcher .dr-right",this.element).addClass("dr-disabled"),r.isBefore(this.earliest_date)&&h(".dr-month-switcher .dr-left",this.element).addClass("dr-disabled"),d.isAfter(this.latest_date)&&h(".dr-year-switcher .dr-right",this.element).addClass("dr-disabled"),l.isBefore(this.earliest_date)&&h(".dr-year-switcher .dr-left",this.element).addClass("dr-disabled"),h(".dr-day",this.element).on({mouseenter:function(){var d=h(this);c(n.start_date),c(n.end_date),c(n.current_date);function t(r){i=void 0,n.range(42).forEach(function(t){var e=d.next().data("date"),a=d.prev().data("date"),s=d.data("date");return!!s&&(a=a||s,e=e||s,"start"==r?!(c(e).isSame(n.end_date)||n.sameDayRange&&c(s).isSame(n.end_date))&&(c(s).isAfter(n.end_date)&&(i=i||c(s).add(6,"day").startOf("day"),5<t||e&&c(e).isAfter(n.latest_date))?(h(d).addClass("dr-end"),i=c(s),!1):void(d=d.next().addClass("dr-maybe"))):"end"==r?!(c(a).isSame(n.start_date)||n.sameDayRange&&c(s).isSame(n.start_date))&&(c(s).isBefore(n.start_date)&&(i=i||c(s).subtract(6,"day"),5<t||a&&c(a).isBefore(n.earliest_date))?(h(d).addClass("dr-start"),i=c(s),!1):void(d=d.prev().addClass("dr-maybe"))):void 0)})}h(n.selected).hasClass("dr-date-start")&&(d.addClass("dr-hover dr-hover-before"),h(".dr-start",n.element).css({border:"none","padding-left":"0.3125rem"}),t("start")),h(n.selected).hasClass("dr-date-end")&&(d.addClass("dr-hover dr-hover-after"),h(".dr-end",n.element).css({border:"none","padding-right":"0.3125rem"}),t("end")),n.start_date||n.end_date||d.addClass("dr-maybe"),h(".dr-selected",n.element).css("background-color","transparent")},mouseleave:function(){h(this).hasClass("dr-hover-before dr-end")&&h(this).removeClass("dr-end"),h(this).hasClass("dr-hover-after dr-start")&&h(this).removeClass("dr-start"),h(this).removeClass("dr-hover dr-hover-before dr-hover-after"),h(".dr-start, .dr-end",n.element).css({border:"",padding:""}),h(".dr-maybe:not(.dr-current)",n.element).removeClass("dr-start dr-end"),h(".dr-day",n.element).removeClass("dr-maybe"),h(".dr-selected",n.element).css("background-color","")}}),/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream?(h(".dr-day",this.element).on({touchstart:function(){n.selectOneDate(i,n,h(this).data("date"))}}),h("div[contenteditable]",this.element).removeAttr("contenteditable")):h(".dr-day",this.element).on({mousedown:function(){n.selectOneDate(i,n,h(this).data("date"))}}),h(".dr-calendar",this.element).css("width",a).slideDown(200),h(".dr-input",this.element).addClass("dr-active"),h(t).addClass("dr-active").focus(),this.element.addClass("dr-active"),this.calIsOpen=!0},t.prototype.calendarClose=function(t){var e=this;if(!this.calIsOpen||this.presetIsOpen||"force"==t?h(".dr-calendar",this.element).slideUp(200,function(){h(".dr-day",e.element).remove()}):h(".dr-day",this.element).remove(),"switcher"==t)return!1;h(".dr-input, .dr-date",this.element).removeClass("dr-active"),this.element.removeClass("dr-active"),this.calIsOpen=!1},t.prototype.calendarCreate=function(t){var s=this;this.calendarArray(this.start_date,this.end_date,this.current_date,t).forEach(function(t,e){var a="dr-day";t.fade&&(a+=" dr-fade"),t.start&&(a+=" dr-start"),t.end&&(a+=" dr-end"),t.current&&(a+=" dr-current"),t.selected&&(a+=" dr-selected"),t.outside&&(a+=" dr-outside"),h(".dr-day-list",s.element).append('<li class="'+a+'" data-date="'+t.date+'">'+t.str+"</li>")})},t.prototype.calendarArray=function(t,e,a,s){a=c(a||t||e).startOf("day");for(var r=s||a||t||e,s=c(r).startOf("month").startOf("week"),d=c(s).add(41,"days").endOf("day"),i=[],n=c(s);n.isBefore(d);)i.push({str:+n.format("D"),start:t&&n.isSame(t,"day"),end:e&&n.isSame(e,"day"),current:a&&n.isSame(a,"day"),selected:t&&e&&n.isBetween(t,e),date:n.toISOString(),outside:n.isBefore(this.earliest_date)||n.isAfter(this.latest_date),fade:!n.isSame(r,"month")}),n.add(1,"d");return i},t.prototype.calendarHTML=function(t){var a=h('<ul class="dr-days-of-week-list"></ul>'),e=this.days_array.splice(c.localeData().firstDayOfWeek()).concat(this.days_array.splice(0,c.localeData().firstDayOfWeek()));return h.each(e,function(t,e){a.append('<li class="dr-day-of-week">'+e+"</li>")}),"double"==t?this.element.append('<div class="dr-input"><div class="dr-dates"><div class="dr-date dr-date-start" contenteditable>'+c(this.start_date).format(this.format.input)+'</div><span class="dr-dates-dash">&ndash;</span><div class="dr-date dr-date-end" contenteditable>'+c(this.end_date).format(this.format.input)+"</div></div>"+(this.presets?'<div class="dr-presets"><span class="dr-preset-bar"></span><span class="dr-preset-bar"></span><span class="dr-preset-bar"></span></div>':"")+'</div><div class="dr-selections"><div class="dr-calendar" style="display: none;"><div class="dr-range-switcher"><div class="dr-switcher dr-month-switcher"><i class="dr-left"></i><span>April</span><i class="dr-right"></i></div><div class="dr-switcher dr-year-switcher"><i class="dr-left"></i><span>2015</span><i class="dr-right"></i></div></div>'+a[0].outerHTML+'<ul class="dr-day-list"></ul></div>'+(this.presets?this.presetCreate()[0].outerHTML:"")+"</div>"):this.element.append('<div class="dr-input"><div class="dr-dates"><div class="dr-date" contenteditable placeholder="'+this.placeholder+'">'+(this.settings.current_date?c(this.current_date).format(this.format.input):"")+'</div></div></div><div class="dr-selections"><div class="dr-calendar" style="display: none;"><div class="dr-range-switcher"><div class="dr-switcher dr-month-switcher"><i class="dr-left"></i><span></span><i class="dr-right"></i></div><div class="dr-switcher dr-year-switcher"><i class="dr-left"></i><span></span><i class="dr-right"></i></div></div>'+a[0].outerHTML+'<ul class="dr-day-list"></ul></div></div>')},t.prototype.parseDate=function(t){return null!==c.defaultZone&&c.hasOwnProperty("tz")?c.tz(t,this.format.input,c.defaultZone.name):c(t,this.format.input)},t.prototype.range=function(t){for(var e=new Array(t),a=0;a<t;a++)e[a]=a;return e},t.prototype.selectOneDate=function(t,e,a){a=c(a).format(e.format.input);t&&h(".dr-date",e.element).not(e.selected).html(t.format(e.format.input)),h(e.selected).html(a),e.calendarOpen(e.selected),h(e.selected).hasClass("dr-date-start")?h(".dr-date-end",e.element).trigger("click"):(e.calendarSaveDates(),e.calendarClose("force"))},t});